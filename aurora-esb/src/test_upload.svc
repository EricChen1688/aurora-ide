<?xml version="1.0" encoding="UTF-8"?>
<a:service xmlns:s="aurora.plugin.script" xmlns:a="http://www.aurora-framework.org/application" xmlns:p="uncertain.proc" trace="true">
    <a:init-procedure>
        <s:server-script><![CDATA[
        importPackage(java.io);
        var bm = $bm('tm_interface_contract_approval');
        var record = bm.queryAsMap({
            process_status: 'N'
        }).getChildren();
        if (record.length == 0){
            return;
        }else {
            for(var i = 0;i < record.length; i++){
                $ctx.parameter.datas.data.applyno = record[i].applyno;
                $ctx.parameter.datas.data.allowloan = record[i].allowloan;
                $ctx.parameter.datas.data.failreason = record[i].failreason;
                $ctx.parameter.datas.data.contractno = record[i].contractno;
                $ctx.parameter.datas.data.reasontype = record[i].reasontype;
                $ctx.parameter.datas.data.applyamount = record[i].applyamount;
            }
            $ctx.parameter.count = record.length;
        }
		]]></s:server-script>
        <p:echo/>
    </a:init-procedure>
    <a:service-output output="/parameter"/>
</a:service>
